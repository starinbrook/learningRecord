
1、网络分层的真实含义

    只要是在网络上跑的包，都是完整的。可以有下层没上层，绝对不可能有上层没下层。
	
	
2、ifconfig命令

    查看ip地址命令：
	windows：ipconfig
	Linux：ifconfig 和 ip addr
	
	扩展知识： 
	ifconfig 和 ip addr 的区别
	ifconfig 是 net-tools 工具提供的命令
	ip addr 是 iproute2 工具提供的命令
	
	net-tools 和 iproute2 的区别
	net-tools起源于BSD，自2001年起，Linux社区已经对其停止维护，而iproute2旨在取代net-tools，并提供了一些新功能。
	一些Linux发行版已经停止支持net-tools，只支持iproute2。
    net-tools通过procfs(/proc)和ioctl系统调用去访问和改变内核网络配置，而iproute2则通过netlink套接字接口与内核通讯。
    net-tools中工具的名字比较杂乱，而iproute2则相对整齐和直观，基本是ip命令加后面的子命令。
    虽然取代意图很明显，但是这么多年过去了，net-tool依然还在被广泛使用，最好还是两套命令都掌握吧。
	
	IP 是地址，有定位功能；MAC 是身份证，无定位功能；
    CIDR 可以用来判断是不是本地人；
    IP 分公有的 IP 和私有的 IP。
	
	ip addr命令结果解析：
	----------------------------------------------------------------------------------
	[root@wx-test-116 ~]# ip addr
    1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN 
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
    2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP qlen 1000
    link/ether 00:50:56:b1:13:e1 brd ff:ff:ff:ff:ff:ff
    inet 10.126.3.116/24 brd 10.126.3.255 scope global eth0
	----------------------------------------------------------------------------------
	inet后面跟的是IP地址
	
	scope：
	对于 eth0 这张网卡来讲，是 global，说明这张网卡是可以对外的，可以接收来自各个地方的包。
	对于 lo 来讲，是 host，说明这张网卡仅仅可以供本机相互通信。
	lo 全称是loopback，又称环回接口，往往会被分配到 127.0.0.1 这个地址。这个地址用于本机通信，经过内核处理后直接返回，不会在任何网络中出现。
	
	link/ether 00:50:56:b1:13:e1 brd ff:ff:ff:ff:ff:ff这个被称为MAC 地址，是一个网卡的物理地址，用十六进制，6 个 byte 表示。
	
	< BROADCAST,MULTICAST,UP,LOWER_UP >这个叫作net_device flags，网络设备的状态标识。
	UP 表示网卡处于启动的状态；
	BROADCAST 表示这个网卡有广播地址，可以发送广播包；
	MULTICAST 表示网卡可以发送多播包；
	LOWER_UP 表示 L1 是启动的，也即网线插着呢。
	
	MTU1500 最大传输单元 MTU 为 1500，这是以太网的默认值。
	MTU 是二层 MAC 层的概念。MAC 层有 MAC 的头，以太网规定连 MAC 头带正文合起来，不允许超过 1500 个字节。
	正文里面有 IP 的头、TCP 的头、HTTP 的头。如果放不下，就需要分片来传输。
	
	qdisc mq 
	qdisc 全称是queueing discipline，中文叫排队规则。内核如果需要通过某个网络接口发送数据包，它都需要按照为这个接口配置的 qdisc（排队规则）把数据包加入队列。
	最简单的 qdisc 是 pfifo，它不对进入的数据包做任何的处理，数据包采用先入先出的方式通过队列。
	
	
3、DHCP与PXE

    手动配置ip地址
	
	使用 net-tools：
    $ sudo ifconfig eth1 10.0.0.1/24
    $ sudo ifconfig eth1 up
	
    使用 iproute2：
    $ sudo ip addr add 10.0.0.1/24 dev eth1
    $ sudo ip link set up eth1

	动态分配ip地址――动态主机配置协议（DHCP）
	只需要配置一段共享的 IP 地址。每一台新接入的机器都通过 DHCP 协议，来这个共享的 IP 地址里申请，然后自动配置好就可以了。
	等人走了，或者用完了，还回去，这样其他的机器也能用。
	
	DHCP 的工作方式：
	DHCP Discover --> DHCP Offer --> DHCP Request --> DHCP ACK
	
	预启动执行环境（Pre-boot Execution Environment），简称PXE。
	数据中心里面的管理员可能一下子就拿到几百台空的机器，一个个安装操作系统，会累死的。
    所以管理员希望的不仅仅是自动分配 IP 地址，还要自动安装系统。装好系统之后自动分配 IP 地址，直接启动就能用了，这样当然最好了！
	通过PXE可以实现上面的要求。
	

4、从物理层到MAC层

    第一层（物理层）：提供物理层联通方案
	
	两台电脑互连：
	物理层设备：一个有两个头的网线
	          注意：水晶头要做交叉线，用的就是所谓的1－3、2－6 交叉接法。
			  水晶头的第 1、2 和第 3、6 脚，它们分别起着收、发信号的作用。
			  将一端的 1 号和 3 号线、2 号和 6 号线互换一下位置，就能够在物理层实现一端发送的信号，另一端能收到。
	网络设置：配置这两台电脑的 IP 地址、子网掩码和默认网关
	
	三台电脑互连：
	物理层设备：集线器Hub
	            集线器没有大脑，它完全在物理层工作。它会将自己收到的每一个字节，都复制到其他端口上去。（广播模式）
	网络设置：配置这三台电脑的 IP 地址、子网掩码和默认网关
	
	第二层（数据链路层，即MAC层）
	解决三个问题：
	（1）这个包是发给谁的？谁应该接收？
    （2）大家都在发，会不会产生混乱？有没有谁先发、谁后发的规则？（多路访问问题）
    （3）如果发送的时候出现了错误，怎么办？
	
	问题（1）解决方案：
	    网络包中引入目标的 MAC 地址和源的 MAC 地址
	问题（2）解决方案：
	    方式一：分多个车道。每个车一个车道，你走你的，我走我的。这在计算机网络里叫作信道划分；
        方式二：今天单号出行，明天双号出行，轮着来。这在计算机网络里叫作轮流协议；
        方式三：不管三七二十一，有事儿先出门，发现特堵，就回去。错过高峰再出。我们叫作随机接入协议。著名的以太网，用的就是这个方式。
	问题（3）解决方案：
	    MAC头中引入CRC，也	就是循环冗余检测。通过 XOR 异或的算法，来计算整个包是否在发送的过程中出现了错误
		
	使用集线器连接多台电脑存在的问题：
	因为 Hub 是广播的，不管某个接口是否需要，所有的 Bit 都会被发送出去，然后让主机来判断是不是需要。
	这种方式路上的车少就没问题，车一多，产生冲突的概率就提高了。而且把不需要的包转发过去，纯属浪费。
	
	二层设备交换机，可以解决集线器存在的问题。
	交换机通过学习会记录一份转发表，通过转发表可以知道交换机每个口连接的电脑的MAC地址
	
	收到网络包，交换机可以从包中拿出MAC头，检查一下目标 MAC 地址，从转发表中找到该MAC地址对应的口，然后从此口转发到特定的电脑。
	

5、交换机与VLAN

    使用多个交换机可能会产生环路问题
	解决方案：STP（Spanning Tree Protocol） 协议
	
	如何解决广播问题和安全问题？
	（1）物理隔离
	     每个部门有单独的交换机，配置单独的子网，这样部门之间的沟通就需要路由器了。
	（2）虚拟隔离
	     虚拟隔离，就是用我们常说的VLAN，或者叫虚拟局域网。使用 VLAN，一个交换机上会连属于多个局域网的机器。
		 交换机怎么区分哪个机器属于哪个局域网呢？
		 只需要在原来的二层的头上加一个 TAG，里面有一个 VLAN ID，一共 12 位。为什么是 12 位呢？因为 12 位可以划分 4096 个 VLAN。
		 如果我们买的交换机是支持 VLAN 的，当这个交换机把二层的头取下来的时候，就能够识别这个 VLAN ID。
		 这样只有相同 VLAN 的包，才会互相转发，不同 VLAN 的包，是看不到的。这样广播问题和安全问题就都能够解决了。

	